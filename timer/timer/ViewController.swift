//
//  ViewController.swift
//  timer
//
//  Created by cmb on 2019/8/20.
//  Copyright © 2019 cmb. All rights reserved.
//

import UIKit

class ViewController: UIViewController {
    
    var timer:Timer? //定义执行变量
    var countTime:Int = 0 //定义总秒数
    var countSec:Int = 0 //倒数时间秒数部分
    
    @IBOutlet weak var buttonStop: UIButton!
    @IBOutlet weak var buttonStart: UIButton!
    @IBOutlet weak var datePicker: UIDatePicker!
    @IBOutlet weak var stepper: UIStepper!
    @IBOutlet weak var labelZero: UILabel!
    @IBOutlet weak var labelMsg: UILabel!
    @IBOutlet weak var labelSecond: UILabel!
    
    @IBAction func stepperClick(_ sender: UIStepper) {
        labelSecond.text = "\(Int(stepper.value))"
    }
    
    @IBAction func startClick(_ sender: UIButton) {
        labelZero.isHidden = true // 不显示0分钟
        buttonStop.isEnabled = true //停止按钮起作用
        buttonStart.isEnabled = false
        labelMsg.text = ""
        datePicker.isEnabled = false
        stepper.isEnabled = false
        countSec = Int(stepper.value) //获取秒数
        countTime = Int(datePicker.countDownDuration) + countSec
        timer = Timer.scheduledTimer(timeInterval: 1, target: self, selector: #selector(countDown) , userInfo: nil, repeats: true)
    }
    
    //定时执行函数
    @objc func countDown() {
        countSec = countSec - 1
        countTime = countTime - 1
        if countSec == -1 {
            if countTime < 0 {
                labelMsg.text = "时间到！"
                stop()
            } else {
                countSec = 59
                labelSecond.text = "\(countSec)"
                datePicker.countDownDuration = TimeInterval(countTime) //重置分钟数
                if countTime < 60 {
                    labelZero.isHidden = false
                }
            }
        } else {
            labelSecond.text = "\(countSec)"
        }
        
    }
    
    func stop() {
        buttonStop.isEnabled = false
        buttonStart.isEnabled = true
        labelZero.isHidden = true
        stepper.isEnabled = true
        datePicker.isEnabled = true
        stepper.value = 0
        labelSecond.text = "0"
        timer!.invalidate() // 停止计时执行
        timer = nil
        
    }
    

    @IBAction func stopClick(_ sender: UIButton) {
        stop()
    }
    
    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view.
        datePicker.datePickerMode = UIDatePicker.Mode.countDownTimer//倒计时模式
        stepper.minimumValue = 0
        stepper.maximumValue = 59
        stepper.value = 0
        labelSecond.text = "0"
        buttonStop.isEnabled = false
        labelZero.isHidden = true
        
    }


}

